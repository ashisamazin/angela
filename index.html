<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pay your Tax Angela!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        canvas {
            background-color: #2e2e50;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            max-width: 95vw;
            max-height: 90vh;
            border: 4px solid #b73939;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 flex flex-col items-center justify-center p-4">
    <div class="flex flex-col items-center p-6 bg-gray-800 rounded-2xl shadow-lg border border-gray-700">
        <h1 class="text-4xl font-bold mb-4 text-center">Pay your Tax!</h1>
        <div class="flex flex-row justify-between w-full mb-4 px-2">
            <div class="text-2xl font-bold">Total Stamp Duty: <span id="score">0</span></div>
            <div class="text-2xl font-bold">Best: <span id="high-score">0</span></div>
        </div>
        <canvas id="gameCanvas" class="rounded-xl border-4 border-red-500 shadow-xl"></canvas>
        <div id="gameOverScreen" class="absolute inset-0 flex flex-col items-center justify-center bg-gray-900 bg-opacity-90 z-10 hidden rounded-xl p-4">
            <h2 class="text-5xl font-bold text-red-500 mb-4 animate-bounce">You missed a stamp duty bill! Now you must resign!</h2>
            <p class="text-2xl mb-4">Final Score: <span id="finalScore" class="font-bold text-3xl text-green-400">0</span></p>
            <button id="playAgainBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-transform transform hover:scale-105">
                Play Again
            </button>
        </div>
        <div id="messageBox" class="absolute hidden bottom-16 bg-gray-700 text-white text-lg px-4 py-2 rounded-lg shadow-xl animate-fade-in-up"></div>
    </div>

    <script>
        // --- Game Setup ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const highScoreEl = document.getElementById('high-score');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScoreEl = document.getElementById('finalScore');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const messageBox = document.getElementById('messageBox');

        let animationFrameId;
        let score = 0;
        let highScore = localStorage.getItem('taxmanHighScore') || 0;
        let isGameOver = false;
        
        // Player (Angela Rayner)
        const playerImage = new Image();
        playerImage.src = 'angela.jpg';
        const player = {
            x: 0,
            y: 0,
            width: 80,
            height: 80,
            speed: 5
        };

        // Tax Bill (enemies)
        let enemies = [];
        let enemySpeed = 1.5;
        let enemySpawnInterval = 1000;
        let lastSpawnTime = 0;
        const enemyWidth = 80;
        const enemyHeight = 40;

        // Sound effects
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(freq, type = 'sine', duration = 0.1) {
            if (!audioCtx) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.type = type;
            oscillator.frequency.value = freq;
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            oscillator.start();
            gainNode.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);
            oscillator.stop(audioCtx.currentTime + duration);
        }

        // --- Game Functions ---
        function setCanvasSize() {
            canvas.width = Math.min(window.innerWidth - 40, 400);
            canvas.height = Math.min(window.innerHeight - 200, 600);
            player.x = (canvas.width / 2) - (player.width / 2);
            player.y = canvas.height - player.height - 20;
        }

        function showMessage(text, duration = 2000) {
            messageBox.textContent = text;
            messageBox.style.display = 'block';
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, duration);
        }

        function drawPlayer() {
            ctx.drawImage(playerImage, player.x, player.y, player.width, player.height);
        }

        function drawEnemy(enemy) {
            ctx.fillStyle = '#b73939';
            ctx.fillRect(enemy.x, enemy.y, enemyWidth, enemyHeight);
            
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 14px "Inter", sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText("Stamp Duty", enemy.x + enemyWidth / 2, enemy.y + enemyHeight / 2);
        }

        function createEnemy() {
            const x = Math.random() * (canvas.width - enemyWidth);
            enemies.push({
                x: x,
                y: -enemyHeight,
                value: 1 // Simple value for scoring
            });
        }

        function update(timestamp) {
            if (isGameOver) {
                cancelAnimationFrame(animationFrameId);
                return;
            }

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Spawn new enemies
            if (timestamp - lastSpawnTime > enemySpawnInterval) {
                createEnemy();
                lastSpawnTime = timestamp;
                // Gradually increase difficulty
                enemySpeed += 0.01;
                enemySpawnInterval = Math.max(200, enemySpawnInterval * 0.995);
            }

            // Update enemies position and check for collisions
            enemies.forEach((enemy, index) => {
                enemy.y += enemySpeed;
                
                // Collision detection (catching the bill)
                if (player.x < enemy.x + enemyWidth &&
                    player.x + player.width > enemy.x &&
                    player.y < enemy.y + enemyHeight &&
                    player.y + player.height > enemy.y) {
                    enemies.splice(index, 1);
                    score += 1;
                    scoreEl.textContent = score;
                    playSound(880, 'sine');
                }

                // If enemy is off screen (missed)
                if (enemy.y > canvas.height) {
                    endGame();
                }
            });

            // Draw everything
            drawPlayer();
            enemies.forEach(drawEnemy);

            animationFrameId = requestAnimationFrame(update);
        }

        function endGame() {
            isGameOver = true;
            finalScoreEl.textContent = score;
            gameOverScreen.classList.remove('hidden');

            if (score > highScore) {
                highScore = score;
                localStorage.setItem('taxmanHighScore', highScore);
                highScoreEl.textContent = highScore;
                showMessage("New High Score!", 3000);
            }
        }

        function resetGame() {
            isGameOver = false;
            score = 0;
            scoreEl.textContent = 0;
            enemies = [];
            enemySpeed = 1.5;
            enemySpawnInterval = 1000;
            gameOverScreen.classList.add('hidden');
            update(0);
        }

        // --- Event Listeners and Initializers ---
        setCanvasSize();
        highScoreEl.textContent = highScore;

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (isGameOver) return;
            if (e.key === 'ArrowLeft' || e.key === 'a') {
                player.x = Math.max(0, player.x - player.speed * 20);
            } else if (e.key === 'ArrowRight' || e.key === 'd') {
                player.x = Math.min(canvas.width - player.width, player.x + player.speed * 20);
            }
        });

        // Touch controls
        let touchX = 0;
        canvas.addEventListener('touchstart', (e) => {
            touchX = e.touches[0].clientX;
        });

        canvas.addEventListener('touchmove', (e) => {
            const newTouchX = e.touches[0].clientX;
            const deltaX = newTouchX - touchX;
            player.x = Math.min(Math.max(0, player.x + deltaX), canvas.width - player.width);
            touchX = newTouchX;
        });
        
        playAgainBtn.addEventListener('click', resetGame);
        window.addEventListener('resize', setCanvasSize);
        window.onload = resetGame;
    </script>
</body>
</html>
